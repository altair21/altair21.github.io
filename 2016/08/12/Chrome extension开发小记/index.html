<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Chrome extension开发小记 · altair21的学习笔记</title><meta name="description" content="Chrome extension开发小记 - altair21"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.jpg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://note.altair21.org/atom.xml" title="altair21的学习笔记"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/avatar.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">首页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">关于</a></li><li class="nav-list-item"><a href="/books" target="_self" class="nav-list-link">书单</a></li><li class="nav-list-item"><a href="https://github.com/altair21" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Chrome extension开发小记</h1><div class="post-info">2016年8月12日</div><div class="post-content"><h2 id="0x00"><a href="#0x00" class="headerlink" title="0x00"></a>0x00</h2><p>每次访问stackoverflow都有一点很烦，就是我如果想看一个回答发布的具体时间，只能把鼠标移到时间上等待两秒出现悬浮窗来显示。由于技术发展太快，所以有些五年前解决这个问题的相关API到了当前很可能已经不适用了或者已有了更好的解决办法，所以stackoverflow上我也会尽量看时间最近的讨论，显示完整的回答/评论发布时间对我来说就会方便很多。<br>为了解决这个痛点，我一直打算自己搞一个chrome的小扩展来修改页面的DOM，刚好今天手头活干完了，看了一下chrome扩展开发的文档，发现比想象中要简单很多，于是自己试了一下，完成了这个小扩展。</p>
<a id="more"></a>
<hr>
<h2 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h2><p>chrome的扩展核心文件是一个json，给浏览器提供一些关于扩展样式和行为的信息（主要是引用资源文件和脚本文件），还有必备属性如扩展名称和版本号。这个json文件叫做<font color="#66ccff">manifest.json</font>，关于它的字段名可以参考<a href="https://developer.chrome.com/extensions/manifest" target="_blank" rel="external">官方文档</a>。这里不再赘述。<br>我的扩展需要在<code>stackoverflow.com/question/*</code>页面上自动执行修改DOM的操作，并且在document加载结束后执行，所以json文件这么写<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">   <span class="attr">"content_scripts"</span>: [ &#123;</div><div class="line">      <span class="attr">"js"</span>: [ <span class="string">"script.js"</span> ],</div><div class="line">      <span class="attr">"matches"</span>: [ <span class="string">"http://stackoverflow.com/questions/*"</span> ],</div><div class="line">      <span class="attr">"run_at"</span>: <span class="string">"document_end"</span></div><div class="line">   &#125; ],</div><div class="line">   <span class="attr">"description"</span>: <span class="string">"This extension can display full date in reply and comment of stackoverflow.com"</span>,</div><div class="line">   <span class="attr">"manifest_version"</span>: <span class="number">2</span>,</div><div class="line">   <span class="attr">"name"</span>: <span class="string">"Stackoverflow Full Date"</span>,</div><div class="line">   <span class="attr">"version"</span>: <span class="string">"0.1"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h2 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h2><p>接下来用chrome的开发者工具找到stackoverflow页面中显示时间的位置，找到对应的标签，answer的时间标签的class是<code>relativetime</code>，comment的时间标签的class是<code>relativetime-clean</code>，完整的时间在标签的title属性里。</p>
<hr>
<h2 id="0x03"><a href="#0x03" class="headerlink" title="0x03"></a>0x03</h2><p>接下来编写<font color="#66ccff">script.js</font>脚本文件。这个脚本需要把上一步提到的那些元素找到，替换标签中间的文本内容为标签的title属性值。<br>脚本一定得在页面DOM元素加载完才能执行，否则是无法找到对应的标签的，所以最理想的位置是<code>document.domContentLoaded</code>发生时。<br>完整代码如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">showFullDate</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> arr = <span class="built_in">document</span>.getElementsByClassName(<span class="string">"relativetime"</span>);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</div><div class="line">        arr[i].childNodes[<span class="number">0</span>].nodeValue = arr[i].getAttribute(<span class="string">"title"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> arr2 = <span class="built_in">document</span>.getElementsByClassName(<span class="string">"relativetime-clean"</span>);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr2.length; i++) &#123;</div><div class="line">        arr2[i].childNodes[<span class="number">0</span>].nodeValue = arr2[i].getAttribute(<span class="string">"title"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">document</span>.domContentLoaded = showFullDate();</div></pre></td></tr></table></figure>
<p>两个文件，11行JavaScript代码，就实现了这个功能。</p>
<hr>
<h2 id="0x04"><a href="#0x04" class="headerlink" title="0x04"></a>0x04</h2><p>其实你的chrome里的所有扩展，你都可以得到源码，方法如下：</p>
<ol>
<li>在chrome地址栏输入<code>chrome://extensions</code>进入扩展程序管理页。</li>
<li>勾选中“开发者模式”，此时得到了所有扩展的ID。</li>
<li>在chrome地址栏输入<code>chrome-extension://&lt;extensionID&gt;/manifest.json</code>。</li>
</ol>
<p>因为在地址栏输入<code>chrome-extension://&lt;extensionID&gt;/&lt;pathToFile&gt;</code>就可以得到扩展程序中的对应文件，而每一个扩展程序必定包含<font color="#66ccff">manifest.json</font>文件，扩展程序的所有html、css、js以及各种图片资源文件都需要在这个json文件中引用，所以可以通过这种方式获取到扩展程序的源码以及静态资源。</p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/10/19/AngularJS 中$timeout 和 $interval 引发的问题/" class="prev">上一篇</a><a href="/2016/08/02/OS X终端配置/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'altair21-note';
var disqus_identifier = '2016/08/12/Chrome extension开发小记/';
var disqus_title = 'Chrome extension开发小记';
var disqus_url = 'http://note.altair21.org/2016/08/12/Chrome extension开发小记/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//altair21-note.disqus.com/count.js" async></script><div class="copyright"><p>© 2014 - 2017 <a href="http://note.altair21.org">altair21</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-56273068-4",'auto');ga('send','pageview');</script></body></html>