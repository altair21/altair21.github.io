<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 用三种方法解决iOS8中TableViewCell的RightDetail不显示内容的问题 · altair21的学习笔记</title><meta name="description" content="用三种方法解决iOS8中TableViewCell的RightDetail不显示内容的问题 - altair21"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.jpg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://note.altair21.org/atom.xml" title="altair21的学习笔记"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/avatar.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">首页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">关于</a></li><li class="nav-list-item"><a href="/books" target="_self" class="nav-list-link">书单</a></li><li class="nav-list-item"><a href="https://github.com/altair21" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">用三种方法解决iOS8中TableViewCell的RightDetail不显示内容的问题</h1><div class="post-info">2016年1月16日</div><div class="post-content"><h2 id="Issue"><a href="#Issue" class="headerlink" title="Issue"></a>Issue</h2><p>　　不知道你有没有遇到过这样的问题，如下图<br>　　<img src="https://ws3.sinaimg.cn/large/0060lm7Tgw1f80a36nfgjj30r80933zm.jpg" alt=""><br>　　第一个ViewController中有一个TableView，只有一个Cell，style为right detail，点击这个Cell会push进入第二个ViewController。第二个ViewController中有一个TextView，我设置了代理方法修改这个TextView的内容会更新到第一个ViewController的那个Cell的detailLabel里，但是当我清空TextView的内容后，再添加新的内容，detailLabel没法立即更新显示，当你手指（鼠标）点上去时它显示了出来，就像图片中显示的那样。<br>　　我进行了很多次测试，发现每一次如果是TextView清空-后退-再进入-添加内容-再后退，都会导致这个问题产生，不论是真机还是模拟器。我只在iOS9和iOS8中进行了测试，发现iOS9中不存在这个问题，不知道是不是iOS8的bug，可以看看stackoverflow上<a href="http://stackoverflow.com/questions/25987135/ios-8-uitableviewcell-detail-text-not-correctly-updating" target="_blank" rel="external">这篇讨论</a>。<br>　　我总结了三种方法来解决这个问题，demo文件传到了github上面：<a href="https://github.com/altair21/RightDetail_issueDemo" target="_blank" rel="external">https://github.com/altair21/RightDetail_issueDemo</a>，有三个branch分别是三种解决方案。<br>　　解决问题之前需要先搞清楚问题出在哪里，我在第一个ViewController的viewWillAppear方法里在控制台输出detailLabel的frame信息，发现detailLabel的frame在每次输出时都是上一个修改之前的值，在这个问题中就是清空之后frame的宽和高还是清空之前的值，只是此时detailLabel没有文字，再添加时返回回来frame的宽和高变为(0,0)，此时即使有文字也显示不出来了。<br>　　知道问题所在之后就好解决了，我想到了三种方法，分别对应三个branch的解决方案。<br>　　<br><a id="more"></a></p>
<hr>
<h2 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution #1"></a>Solution #1</h2><p>　　第一个思路是这样，既然布局更新不及时那就在每次第一个ViewController执行viewWillAppear时让它刷新Cell子控件的布局，具体做法就是在viewWillAppear中执行<code>tableCell.setNeedsLayout()</code>语句，所以这个方法看上去应该像这样：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(animated: Bool)</span></span> &#123;</div><div class="line">		<span class="keyword">super</span>.viewWillAppear(animated)</div><div class="line">		tableCell.setNeedsLayout()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行效果如下图<br><img src="https://ws3.sinaimg.cn/large/0060lm7Tgw1f80a36nfgjj30r80933zm.jpg" alt=""></p>
<p>　　可以看到有一些延迟，这个原因我也不知道，心里猜了个大概，但是没有查资料佐证，所以不敢乱说。</p>
<hr>
<h2 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution #2"></a>Solution #2</h2><p>　　第二个方法思路和第一个一样，不同的是这回我靠手动编写代码的方式来更新detailLabel的布局，你可以选择让detailLabel调用<code>sizeToFit</code>方法调整自己的宽度，再更新它的位置，或者选择根据传来的字符串调用<code>sizeWithAttributes</code>方法计算它应有的宽度，再用这个值去更新detailLabel的大小和位置，我选择的是后者<br>　　在实现第二个ViewController的代理方法时添加了几个语句，代码看上去是这样：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">func textViewChanged(text: String) &#123;</div><div class="line">    rightLabel<span class="selector-class">.text</span> = text</div><div class="line">    let string = text as NSString</div><div class="line">    let contentSize = string.sizeWithAttributes([NSFontAttributeName: self<span class="selector-class">.rightLabel</span><span class="selector-class">.font</span>])</div><div class="line">    let contentWidth = contentSize<span class="selector-class">.width</span></div><div class="line">    let contentHeight = contentSize<span class="selector-class">.height</span></div><div class="line">    let rightLabelMaxX = CGRectGetMaxX(rightLabel.frame)</div><div class="line">    rightLabel<span class="selector-class">.frame</span> = CGRectMake(rightLabelMaxX - contentWidth, rightLabel<span class="selector-class">.frame</span><span class="selector-class">.origin</span><span class="selector-class">.y</span>, contentWidth, contentHeight)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行效果如下图<br><img src="https://ws3.sinaimg.cn/large/0060lm7Tgw1f80a36nfgjj30r80933zm.jpg" alt=""></p>
<p>　　可以看出显示效果和第一个方法差不多，也存在延迟</p>
<hr>
<h2 id="Solution-3"><a href="#Solution-3" class="headerlink" title="Solution #3"></a>Solution #3</h2><p>　　前两种方法虽然显示出来了，但是存在肉眼可以观察到的延迟，非常不理想（但我还是建议你尝试一下，因为我之前测试时第二种方法是没有延迟的）。第三种方法换了一个实现思路，既然空字符串会导致detailLabel的宽和高变为(0,0)，进而导致文字显示不出来，那就让它不要变为(0,0)，也就是不要让它的空字符串传过来，于是将代码处理成这样：<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">func textViewChanged(<span class="built_in">text</span>: <span class="keyword">String</span>) &#123;</div><div class="line">    <span class="built_in">if</span> <span class="built_in">text</span> == <span class="string">""</span> &#123;</div><div class="line">        rightLabel.<span class="built_in">text</span> = <span class="string">" "</span></div><div class="line">    &#125; <span class="built_in">else</span> &#123;</div><div class="line">        rightLabel.<span class="built_in">text</span> = <span class="built_in">text</span></div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>运行效果如下图<br><img src="https://ws3.sinaimg.cn/large/0060lm7Tgw1f80a36nfgjj30r80933zm.jpg" alt=""></p>
<p>　　这一回立刻刷新了，不过有一个问题需要注意，因为我们在push进入第二个ViewController之前手动用detailLabel给它的textView的text属性赋了值，假如我们强制将空字符串转为一个空格，在push进去之后那个textView就不为空，而是有一个空格，不过解决这个问题的方法就有很多了，你可以加一个标记值，再加逻辑判断等等，或者干脆提出更好的解决方法:)</p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/05/16/我的毕业设计/" class="prev">上一篇</a><a href="/2016/01/08/githug攻略(1~55)/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'altair21-note';
var disqus_identifier = '2016/01/16/用三种方法解决iOS8中TableViewCell的RightDetail不显示内容的问题/';
var disqus_title = '用三种方法解决iOS8中TableViewCell的RightDetail不显示内容的问题';
var disqus_url = 'http://note.altair21.org/2016/01/16/用三种方法解决iOS8中TableViewCell的RightDetail不显示内容的问题/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//altair21-note.disqus.com/count.js" async></script><div class="copyright"><p>© 2014 - 2018 <a href="http://note.altair21.org">altair21</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-56273068-4",'auto');ga('send','pageview');</script></body></html>